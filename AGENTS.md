# Repository Guidelines

## Project Structure & Module Organization
- `src/` holds the application code.
- TanStack Start routing entrypoints:
  - `src/router.tsx` creates the router.
  - `src/routes/` contains file-based route definitions.
  - `src/routeTree.gen.ts` is generated by TanStack Router.
- Domain modules live in `src/features/` (`training`, `progress`, `body-comp`, `readiness`) with local `components/`, `queries.ts`, and types/helpers.
- Shared UI primitives live in `src/components/ui/`.
- Layout-level composition is in `src/layouts/` (for example `src/layouts/app-layout/`).
- Shared infrastructure lives in `src/lib/` (Supabase client, sync, temporal/date helpers, auth context).
- `wrangler.jsonc` defines Cloudflare Worker deploy config for TanStack Start server output.
- `supabase/migrations/` contains SQL migrations; `public/` holds static assets; `docs/` has product/domain notes; `dist/` is build output.

## Build, Test, and Development Commands
- `pnpm install`: install dependencies.
- `pnpm dev`: run Vite dev server.
- `pnpm routegen`: regenerate TanStack Router file-route types/tree.
- `pnpm typecheck`: run route generation and TypeScript checks (`pnpm routegen && tsc -b`).
- `pnpm build`: run route generation and production build (`pnpm routegen && vite build`) into `dist/`.
- `pnpm deploy`: build and deploy to Cloudflare via Wrangler.
- `pnpm preview`: serve the production build locally.
- `pnpm lint` / `pnpm lint:fix`: run/fix lint rules via `oxlint`.
- `pnpm format` / `pnpm format:check`: format/check code via `oxfmt`.

## Coding Style & Naming Conventions
- Language stack: TypeScript + React 19.
- Formatting is enforced by `oxfmt` (`printWidth: 80`, `semi: false`); lint rules are in `.oxlintrc.json`.
- Prefer small feature modules and colocate domain logic with the feature.
- Use kebab-case for filenames (for example, `readiness-card.tsx`, `volume-utils.ts`).
- Keep TanStack file routes in `src/routes/`.
- Keep shared primitives in `src/components/ui/`.

## Architecture Overview
- The app boots through TanStack Start (`src/routes/__root.tsx` + `src/router.tsx`), where providers (React Query/auth) and global runtime bridges are wired.
- File-based routes in `src/routes/` map URLs to page/layout modules under `src/layouts/` and `src/features/`.
- Feature modules in `src/features/*` own UI, query logic, and types for each domain; route pages compose these modules.
- This app is intentionally offline-first SPA: route modules are client-rendered (`ssr: false`), with no API routes/server functions in this repository.
- Persistence is split: local-first session/log data in IndexedDB helpers (`src/lib/training-db.ts`) and cloud sync/auth via Supabase (`src/lib/supabase.ts`, `src/lib/sync.ts`).
- SQL schema, RLS, and sync RPC changes must be versioned only through `supabase/migrations/`.

## Testing Guidelines
- No automated test runner is configured yet in `package.json`.
- Minimum quality gate for every change: `pnpm typecheck`, `pnpm lint`, `pnpm build`, and a smoke test in `pnpm dev`.
- If you add tests, colocate as `*.test.ts`/`*.test.tsx` near the feature and include the corresponding script changes in the same PR.

## Commit & Pull Request Guidelines
- Follow Conventional Commit style (`feat:`, `refactor:`, `fix:`), optional scope (`feat(settings): ...`).
- Keep commit messages imperative and concise; separate refactors from behavior changes.
- PRs should include: summary, linked issue (if any), UI screenshots, and migration notes for `supabase/migrations/` changes.

## Security & Configuration Tips
- Create `.env` from `.env.example` and set `VITE_SUPABASE_URL` and `VITE_SUPABASE_ANON_KEY`.
- Do not commit secrets, local env files, or generated artifacts.
